# ШІ-Агент контактного центру

Інтелектуальний голосовий агент для автоматизації обробки звернень громадян на гарячу лінію контактного центру.

## 🎯 Можливості

- **🎙️ Розпізнавання мови (ASR)** — Silero STT для української мови
- **🔊 Синтез мовлення (TTS)** — Fish Speech для природного голосу
- **📊 Класифікація запитів** — на основі офіційного класифікатора
- **👤 Передача оператору** — автоматична ескалація складних випадків
- **💾 Інтеграція з базою даних** — збереження всіх звернень
- **🔒 Безпека** — HTTP Basic Auth та Rate Limiting

## 🏗️ Архітектура

```
┌─────────────────────────────────────────────────────────┐
│                    Вхідний дзвінок                      │
└─────────────────────────┬───────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────┐
│                   Voice Gateway                          │
│              (SIP/WebRTC/Twilio)                        │
└─────────────────────────┬───────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────┐
│                    Silero ASR                            │
│              (Розпізнавання голосу)                     │
│                   Українська мова                        │
└─────────────────────────┬───────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────┐
│                  Класифікатор NLU                        │
│            (Офіційний класифікатор)                     │
└─────────────────────────┬───────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────┐
│                   Fish Speech TTS                        │
│               (Синтез відповіді)                        │
│                 Природний голос                          │
└─────────────────────────┬───────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────┐
│                   SQLite / База даних                   │
│            (Збереження звернень)                        │
└─────────────────────────────────────────────────────────┘
```

## 📦 Встановлення

### Вимоги

- **Python 3.10+**
- **Node.js 18+**
- **GPU** (рекомендовано для Fish Speech)
- **8+ GB RAM**

### Backend (Python)

```bash
cd backend

# Копіювання та налаштування .env
cp .env.example .env
# Відредагуйте .env з вашими налаштуваннями

# Створення віртуального середовища
python -m venv venv
source venv/bin/activate  # Linux/Mac
# або venv\Scripts\activate  # Windows

# Встановлення залежностей
pip install -r requirements_fixed.txt

# Запуск сервера
python main_fixed.py
```

### Frontend (React)

```bash
cd frontend
npm install
npm run dev      # Розробка
npm run build    # Продакшн
```

## 🔐 Аутентифікація

API захищений HTTP Basic Auth:

| Ендпоінт | Користувач | Пароль | Опис |
|----------|------------|--------|------|
| `/api/classify` | `api_user` | з `.env` | Класифікація запитів |
| `/api/transcribe` | `api_user` | з `.env` | Транскрибування аудіо |
| `/api/synthesize` | `api_user` | з `.env` | Синтез мовлення |
| `/api/references/*` | `admin` | з `.env` | Управління довідниками |

Налаштування в `.env`:
```env
API_USERNAME=api_user
API_PASSWORD=your_secure_password
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your_secure_admin_password
```

## 🚀 API Endpoints

### Публічні ендпоінти

| Метод | Endpoint | Опис |
|-------|----------|------|
| GET | `/` | Головна сторінка API |
| GET | `/api/health` | Перевірка стану системи |

### Захищені ендпоінти (потребує аутентифікації)

| Метод | Endpoint | Опис |
|-------|----------|------|
| POST | `/api/classify` | Класифікація тексту |
| POST | `/api/transcribe` | Транскрибування аудіо |
| POST | `/api/synthesize` | Синтез мовлення |
| GET | `/api/history` | Історія дзвінків |
| GET | `/api/stats` | Статистика |

### Довідники (admin доступ)

| Метод | Endpoint | Опис |
|-------|----------|------|
| GET/POST | `/api/references/executors` | Виконавці |
| GET/POST | `/api/references/classifiers` | Класифікатор |
| GET/POST | `/api/references/algorithms` | Алгоритми |

### WebSocket

| Endpoint | Опис |
|----------|------|
| `/ws/call` | Реальний час обробки дзвінків |

## 📋 Приклад класифікації

```bash
curl -X POST http://localhost:8000/api/classify \
  -H "Content-Type: application/json" \
  -u api_user:password \
  -d '{"text": "У нас немає опалення вже другий день"}'
```

Відповідь:
```json
{
  "success": true,
  "query": "У нас немає опалення вже другий день",
  "classification": {
    "id": "4",
    "problem": "Інженерні мережі",
    "type": "Опалення",
    "subtype": "відсутність опалення",
    "executor": "Служба теплопостачання",
    "urgency": "emergency",
    "response_time": 3,
    "confidence": 0.92,
    "needs_operator": false
  }
}
```

## 🎙️ Інтеграція Fish Speech

Fish Speech — це open-source TTS модель з природним звучанням:

```python
from tts_service import synthesize_speech

# Синтез мовлення
audio_bytes, sample_rate = synthesize_speech(
    text="Вашу заявку прийнято",
    voice="default"
)
```

### Клонування голосу

Fish Speech дозволяє клонувати голос з 10-30 секунд аудіо:

```python
from tts_service import tts_service

# Клонування голосу оператора
tts_service.clone_voice(
    reference_audio=operator_audio_bytes,
    voice_id="operator_olena"
)
```

## 📋 Класифікатор

Система використовує універсальний класифікатор заявок:

| Категорія | Підтип | Виконавець | Термін |
|-----------|--------|------------|--------|
| Благоустрій | Розчистка снігу | Управителі будинків | 24 год |
| Благоустрій | Впавше дерево | Аварійна служба | 3 год |
| Інженерні мережі | Відсутність опалення | Служба теплопостачання | 3 год |
| Інженерні мережі | Відсутність води | Служба водопостачання | 2 год |
| Громадський транспорт | Скарга на водія | Департамент транспорту | 5 днів |
| Надзвичайні ситуації | Руйнування | Управління НС | 1 год |

## 🔒 Безпека

- **HTTP Basic Auth** для всіх API ендпоінтів
- **Rate Limiting** — 10 запитів/хв для API
- **CORS** — налаштовується через `ALLOWED_ORIGINS`
- **Валідація** вхідних даних через Pydantic
- **Логування** всіх запитів та помилок

## 📊 Статистика

Система автоматично збирає статистику:
- % автоматично вирішених дзвінків
- Найчастіші категорії звернень
- Середній час відповіді
- Кількість ескалацій на оператора

## 🛠️ Технології

- **Frontend**: React, TailwindCSS, Lucide Icons
- **Backend**: FastAPI, Python
- **ASR**: Silero STT (українська)
- **TTS**: Fish Speech / Edge TTS
- **Database**: SQLite / PostgreSQL
- **Security**: HTTP Basic Auth, Rate Limiting

## 📄 Ліцензія

Внутрішній проект.

## 👥 Контакти

- **Email**: support@example.com
- **Телефон**: Гаряча лінія
